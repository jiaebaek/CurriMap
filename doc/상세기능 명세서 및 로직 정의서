상세 기능 명세서 & 로직 정의서

본 문서는 **User App(사용자 앱)**과 **Admin Web(관리자 웹)**의 세부 기능 및 데이터 처리 로직을 정의한다.
**A. User App (사용자 앱) 핵심 로직**

**0. 온보딩 & 진단 (Onboarding & Diagnosis) - 🔥 신규 추가**

- **목적:** 사용자 데이터를 수집하여 **초기 로드맵 코스(Level)**를 배정한다.
- **Flow:**
    1. **자녀 정보:** 이름, 나이(개월수), 성별.
    2. **관심사 태그:** 이미지 그리드에서 3개 이상 선택 (공룡, 공주, 탈것, 우주, 요리 등).
    3. **레벨 진단 (자가 진단):** * 질문: "아이가 영어책을 읽을 때..."
        - 선택지:
        A. 알파벳만 알아요 (Pre-K)
        B. 단어를 띄엄띄엄 읽어요 (AR 0~1)
        C. 짧은 문장을 혼자 읽어요 (AR 1~2)
        D. 챕터북을 읽을 수 있어요 (AR 2+)
    4. **결과 매칭:** 진단 결과에 따라 초기 `current_level` 설정 및 해당 레벨의 **추천 도서 리스트(Roadmap Queue)** 생성.

**1. 홈: 오늘의 미션 (Daily Mission) 추천 로직**
• **기능 정의:** 사용자 편의를 위해 '오늘 읽으면 딱 좋은 1권'을 제안하되, 선택권을 보장한다.
• **트리거:** 앱 실행 시 or 매일 자정(00:00) 갱신.
• **추천 알고리즘 (MVP 단계: Rule-based):**
    1. **필터링 1 (Level):** 자녀의 `current_level` ±0.5 범위 내의 도서 검색.
    2. **필터링 2 (Interest):** 자녀의 `interests` 배열과 도서의 `themes` 배열 중 1개 이상 일치하는 도서 검색.
    3. **필터링 3 (Unread):** `mission_logs` 테이블에 기록되지 않은(안 읽은) 도서만 추출.
    4. **선정 (Random):** 위 조건에 맞는 도서 중 랜덤 1권 선정.
    5. **예외 처리 (Fallback):**
        ▪ 조건에 맞는 책이 없을 경우 → `current_level`에 맞는 '베스트셀러(인기순)' 도서 노출.
        ▪ 그래도 없으면 → 관리자가 지정한 '필독 도서(Default)' 노출.

- **로직:**
    1. **Main Card:** 현재 진행 중인 로드맵 리스트 중 **가장 우선순위가 높은 1권** 노출.
    2. **새로고침(Swap):** "이 책은 집에 없어요/별로예요" 버튼 클릭 시.
        - Action: 같은 단계(Level) & 관심사(Interest) 내의 다른 도서로 즉시 교체.
        - 이때, '다음에 읽기(Skip)' 상태로 DB에 저장하여 리스트 순서 뒤로 보냄.
    3. **다른 책 기록하기(Log Anything):**
        - 상황: 추천된 책 말고 집에 있는 다른 원서를 읽었을 때.
        - Action: 검색창을 띄워 사용자가 직접 책을 찾고 미션 완료 처리. (이것도 오늘의 미션 성공으로 인정)

**2. 도서 검색: 교차 필터링 로직 (Smart Search)**
• **기능 정의:** 사용자가 지정한 복합 조건에 맞는 도서를 DB에서 쿼리하여 결과값을 리턴한다.
• **입력 변수 (Filters):**
    ◦ `AR Level` (예: 1.0 ~ 2.0)
    ◦ `Themes` (예: ['공룡', '자동차']) - 다중 선택 가능 (OR 조건)
    ◦ `Moods` (예: ['웃긴']) - **필수 구현 사항**
• **정렬 기준 (Sort):**
    ◦ 기본: 최신 등록순
    ◦ 옵션: 인기순 (`mission_logs`의 `child_reaction`이 'love'인 횟수 집계)

**3. 미션 완료 및 보상 로직 (Feedback Loop)**
• **기능 정의:** 미션 완료 버튼 클릭 시 데이터를 저장하고, 사용자에게 피드백을 제공한다.
• **데이터 처리 프로세스:**
    1. 사용자가 **[완료하기]** 버튼 클릭. (이미 완료한 책을 다시 클릭하여 **[또 읽었어요]** 버튼 클릭 가능.)
    2. 모달 팝업: **"아이가 책을 좋아했나요?"** (😍/🙂/☹️) 선택 필수.
    3. **DB 저장 (Transaction):**
        ▪ `mission_logs` 테이블에 `book_id`, `user_id`, `child_reaction` 저장.
        ▪ `books` 테이블의 해당 도서 `read_count` +1 증가 (인기도 산정용).
    4. **성장 데이터 갱신:**
        ▪ 해당 도서의 `word_count`를 가져와 사용자의 '누적 읽은 단어 수'에 합산.
        ▪ 연속 학습일(Streak) 계산 후 업데이트.

### 4. 로드맵 뷰 & 전체 리스트 (Roadmap View)

- **기능 정의:** 현재 위치를 파악하고 다음 읽을 책을 미리 준비(Pre-order)할 수 있는 지도 화면.
- **UI 구성:**
    - **Progress Map:** 구불구불한 길이나 스테이지 형태의 UI.
    - **현재 위치:** 내 아이의 캐릭터가 서 있는 위치 표시.
    - **도서 리스트 (Group):**
        - **완료한 책 (Past):** 흐릿하게 처리 + '3번 읽음' 뱃지 표시.
        - **현재 단계 (Current):** 컬러풀하게 활성화 + 클릭 시 구매/대여 정보 확인 가능.
        - **다음 단계 (Future):** 자물쇠 아이콘(잠금) 또는 반투명 처리 (목표 제시).
- **기능:**
    - **전체 보기:** 현재 레벨에 배정된 도서 리스트(예: 50권)를 한 번에 볼 수 있음 (쇼핑 리스트 역할).

### 5. 성장 리포트 (Report)

- **기능 정의:** 엄마표 영어의 불안감을 해소할 수 있는 데이터 시각화.
- **주요 지표:**
    - **누적 읽은 권수:** (반복 독서 포함)
    - **어휘 노출량 (Word Count):** 책 DB에 있는 단어 수 × 읽은 횟수 누적 합산.
        - *Visual:* "지금까지 아이가 마신 영어 단어는 사과 🍎 500개 분량이에요!"

**B. Admin Web (관리자 페이지) 기능 명세**
*개발사가 간과하기 쉬운 부분입니다. 반드시 스펙에 포함시켜야 합니다.*
**1. 대시보드 (Dashboard)**
• **기능:** 앱 운영 현황을 한눈에 파악.
• **주요 지표:**
    ◦ 총 회원 수 / 금일 가입자 수
    ◦ 누적 미션 완료 횟수
    ◦ **인기 검색 키워드 Top 10** (엄마들이 뭘 검색하는지 파악하여 도서 소싱에 활용)
**2. 도서 관리 (CMS) - 가장 중요**
• **기능:** 앱에 노출될 도서 데이터를 등록, 수정, 삭제하는 기능.
• **등록 프로세스 (Create):**
    1. **기본 정보 입력:** 제목, 저자, ISBN, 표지 이미지 URL, AR 레벨.
    2. **큐레이션 태그 선택 (체크박스):**
        ▪ 주제 (Themes): [ ]공룡 [ ]공주 [ ]일상 ...
        ▪ 분위기 (Moods): [ ]웃긴 [ ]감동 [ ]무서운 ...
    3. **엄마표 데이터 입력 (Text Area):**
        ▪ **Mom's Tip:** (예: "3페이지에서 늑대 흉내를 내주세요.")
        ▪ **Key Words:** (예: "Run, Pig, Wolf")
    4. **수익화 정보:** 구매 링크 URL 입력.
• **조회/수정:** 등록된 도서 리스트 조회 및 내용 수정.
**3. 사용자 관리 (User Management)**
• **기능:** 가입된 회원 리스트 조회.
• **상세:** 특정 회원의 자녀 프로필 정보(나이, 레벨) 및 미션 수행 이력 조회 (CS 대응용).
**C. 데이터베이스 연동 및 API 명세 (간략)**
개발자가 백엔드 API를 설계할 때 참고할 기준입니다.**MethodEndpoint설명필수 파라미터GET**`/api/books/daily`오늘의 미션 도서 1권 조회`user_id` (서버에서 레벨/취향 조회 후 로직 처리)**GET**`/api/books/search`필터 기반 도서 검색`min_ar`, `max_ar`, `themes[]`, `moods[]`**POST**`/api/mission/complete`미션 완료 및 피드백 저장`user_id`, `book_id`, `reaction`, `checklist`**GET**`/api/user/stats`사용자 성장 리포트 조회`user_id`
**D. 예외 처리 및 엣지 케이스 (Edge Cases)**
1. **네트워크 연결 끊김:**
    ◦ 미션 완료 버튼을 눌렀는데 인터넷이 끊긴 경우, 로컬 스토리지에 임시 저장했다가 네트워크 복구 시 자동 전송 (React Query/Offline Mutation 활용 권장).
2. **이미지 로딩 실패:**
    ◦ 도서 표지 이미지가 깨질 경우, 앱 로고가 들어간 'Default Placeholder' 이미지 노출.
3. **검색 결과 없음:**
    ◦ 필터 조건이 너무 까다로워 결과가 0건일 경우, **"조건을 하나만 줄여보세요!"**라는 문구와 함께 가장 근접한(유사한) 도서 리스트를 보여줌 (빈 화면 노출 금지).

## B. 데이터베이스 스키마 수정 요청 (DB Schema Updates)

개발자에게 아래 컬럼 추가/수정을 요청해야 합니다.

1. `books` 테이블:
    - `sequence_order`: 로드맵 내에서의 정렬 순서 (Int)
    - **삭제:** `mission_logs`에서 안 읽은 것만 가져오는 로직 삭제 (모두 가져오되 UI로 구분).
2. `mission_logs` 테이블:
    - `read_count`: 읽은 횟수 (Int, Default 1) - **반복 독서 카운팅용**.
    - `is_manual_log`: 추천이 아닌 직접 검색해서 등록했는지 여부 (Boolean).