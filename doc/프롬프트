# 프로젝트 개발 요청 (DB 설계 포함)

## 1. 프로젝트 개요
당신은 경험이 풍부한 풀스택 개발자이자 데이터베이스 아키텍트입니다. 제공된 문서들을 기반으로 최적화된 DB 스키마를 설계하고, 고품질의 프로덕션 레벨 코드를 작성해주세요.

**제공 문서:**
- 사업정의
- 타겟 페르소나 정의
- PRD (제품 요구사항 정의서)
- 상세기능 명세서 및 로직 정의서 
- 기능 명세서
- 메뉴 구조도(IA) 및 사용자 흐름(User Flow)

## 2. 개발 요구사항

### 기술 스택
- Frontend: [React Native 모바일 어플리케이션]
- Backend: [Node.js시]
- Database: [PostgreSQL]
- ORM/ODM: [알아서 선택해주세요]
- 기타: [필요한 라이브러리나 프레임워크]

### 코드 품질 기준
1. **클린 코드**: 읽기 쉽고 유지보수가 용이한 코드
2. **모듈화**: 재사용 가능한 컴포넌트/함수 구조
3. **에러 핸들링**: 모든 edge case 처리
4. **보안**: SQL injection, XSS 등 보안 취약점 방어
5. **성능 최적화**: 효율적인 쿼리 및 렌더링
6. **주석**: 복잡한 로직에 대한 명확한 설명

## 3. 개발 프로세스

### Phase 1: 요구사항 분석 및 DB 설계
1. **문서 분석**
   - PRD의 모든 기능 요구사항 파악
   - 상세기능 명세서의 데이터 요구사항 추출
   - User Flow에서 필요한 데이터 흐름 분석

2. **DB 스키마 설계**
   - 엔티티(테이블) 식별 및 정의
   - 속성(컬럼) 정의 및 데이터 타입 선정
   - 관계(Relationship) 정의 (1:1, 1:N, N:M)
   - 제약조건(Constraints) 정의
   - 인덱스 전략 수립
   - 정규화 수준 결정 (일반적으로 3NF까지)

3. **DB 스키마 문서 작성**
```markdown
   ## 테이블명: users
   ### 설명
   사용자 정보를 저장하는 테이블
   
   ### 컬럼
   | 컬럼명 | 데이터타입 | 제약조건 | 설명 |
   |--------|-----------|---------|------|
   | id | UUID/BIGINT | PK, NOT NULL | 사용자 고유 ID |
   | email | VARCHAR(255) | UNIQUE, NOT NULL | 이메일 |
   | password | VARCHAR(255) | NOT NULL | 암호화된 비밀번호 |
   | created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | 생성일시 |
   | updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | 수정일시 |
   
   ### 인덱스
   - PRIMARY KEY (id)
   - UNIQUE INDEX (email)
   - INDEX (created_at)
   
   ### 관계
   - users 1:N posts (user_id)
```

4. **스키마 검증 사항 질문**
   - 불명확한 데이터 요구사항
   - 잠재적 성능 이슈
   - 확장성 고려사항
   - 데이터 무결성 관련 질문

### Phase 2: 구현
1. **DB 마이그레이션 파일 작성**
   - 초기 스키마 생성 SQL/마이그레이션
   - 시드 데이터 (필요시)

2. **데이터 모델 구현**
   - ORM 모델 정의
   - 관계 설정
   - Validation 규칙

3. **API 및 비즈니스 로직**
   - CRUD 작업
   - 복잡한 쿼리 최적화
   - 트랜잭션 처리

4. **프론트엔드 구현**
   - IA에 따른 라우팅 및 페이지 구조
   - User Flow에 따른 기능 구현
   - API 연동

### Phase 3: 검증 및 최적화
1. 기능 명세서의 모든 항목 체크
2. User Flow의 각 단계 검증
3. 쿼리 성능 테스트 및 최적화
4. 데이터 무결성 검증

## 4. DB 설계 가이드라인

### 필수 고려사항
1. **명명 규칙**
   - 테이블명: snake_case, 복수형 (users, order_items)
   - 컬럼명: snake_case, 명확한 의미
   - 외래키: {참조테이블}_id (user_id, product_id)

2. **공통 컬럼 (모든 테이블에 포함 권장)**
   - id: 기본키
   - created_at: 생성일시
   - updated_at: 수정일시
   - deleted_at: 소프트 삭제 (필요시)

3. **데이터 무결성**
   - NOT NULL 제약조건 적극 활용
   - FOREIGN KEY 제약조건 설정
   - UNIQUE 제약조건으로 중복 방지
   - CHECK 제약조건으로 데이터 검증

4. **성능 최적화**
   - 자주 조회되는 컬럼에 인덱스 생성
   - 복합 인덱스 고려 (WHERE, JOIN에 자주 사용되는 컬럼 조합)
   - 과도한 인덱스는 INSERT/UPDATE 성능 저하
   - N+1 쿼리 문제 방지를 위한 관계 설계

5. **확장성 고려**
   - 파티셔닝이 필요할 대용량 테이블 식별
   - 향후 컬럼 추가 가능성 고려
   - JSON/JSONB 타입 활용 (유연한 스키마 필요시)

6. **보안**
   - 민감 정보(비밀번호, 카드정보) 암호화
   - 개인정보는 별도 테이블 분리 고려
   - 접근 권한 설정

### DB 타입별 선택 가이드
- **VARCHAR vs TEXT**: 길이 제한이 명확하면 VARCHAR, 가변적이면 TEXT
- **INT vs BIGINT**: 대용량 데이터 예상시 BIGINT
- **TIMESTAMP vs DATETIME**: timezone 필요시 TIMESTAMP
- **ENUM vs VARCHAR**: 고정된 선택지는 ENUM 또는 별도 테이블

## 5. 결과물 요구사항

### 1단계 결과물: DB 스키마 문서
```
database/
├── schema/
│   ├── ERD.png (또는 다이어그램 링크)
│   ├── schema.md (전체 스키마 상세 문서)
│   └── relations.md (테이블 간 관계 설명)
├── migrations/
│   ├── 001_create_users.sql
│   ├── 002_create_posts.sql
│   └── ...
└── seeds/
    └── dev_data.sql (개발용 샘플 데이터)
```

**스키마 문서 필수 포함 사항:**
- 모든 테이블 정의 (컬럼, 타입, 제약조건)
- ERD (Entity Relationship Diagram)
- 인덱스 전략
- 테이블 간 관계 설명
- 확장성 및 성능 고려사항
- 데이터 마이그레이션 계획 (기존 시스템이 있는 경우)

### 2단계 결과물: 전체 코드
```
project/
├── database/
│   └── (위 DB 스키마 문서)
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   ├── pages/
│   │   ├── hooks/
│   │   ├── utils/
│   │   └── api/
│   └── package.json
├── backend/
│   ├── src/
│   │   ├── models/ (ORM 모델)
│   │   ├── controllers/
│   │   ├── routes/
│   │   ├── middleware/
│   │   ├── services/
│   │   └── utils/
│   ├── prisma/ (또는 다른 ORM 설정)
│   └── package.json
└── README.md
```

### 필수 문서
1. **DB 스키마 문서** (위 참조)

2. **README.md**
   - 프로젝트 설명
   - 설치 방법
   - 환경 변수 설정 (DB 연결 정보 포함)
   - DB 초기화 방법
   - 실행 방법

3. **API 문서**
   - 모든 엔드포인트 목록
   - 요청/응답 예시
   - 에러 코드 설명

4. **배포 가이드**
   - DB 마이그레이션 절차
   - 프로덕션 배포 절차
   - 백업 및 복구 전략

## 6. 중요 체크포인트

### DB 설계 단계 확인사항:
- [ ] 모든 기능에 필요한 데이터가 저장 가능한가?
- [ ] 데이터 중복이 최소화되어 있는가?
- [ ] 관계 설정이 올바른가? (1:N, N:M 등)
- [ ] 외래키 제약조건이 적절한가?
- [ ] 인덱스 전략이 쿼리 패턴과 일치하는가?
- [ ] 확장성이 고려되어 있는가?
- [ ] 민감 정보 보안이 고려되어 있는가?
- [ ] 성능 병목 가능성은 없는가?

### 구현 전 확인사항:
- [ ] PRD의 모든 핵심 기능이 명세서에 반영되었는가?
- [ ] DB 스키마가 모든 기능을 지원하는가?
- [ ] User Flow에 누락된 단계는 없는가?
- [ ] 불명확하거나 모순되는 요구사항은 없는가?

### 구현 후 확인사항:
- [ ] 모든 기능 명세가 구현되었는가?
- [ ] 각 User Flow가 정상 작동하는가?
- [ ] DB 마이그레이션이 정상 동작하는가?
- [ ] 쿼리 성능이 최적화되었는가?
- [ ] 에러 처리가 적절한가?
- [ ] 보안 취약점은 없는가?

## 7. 작업 방식

### Step 1: 요구사항 분석 및 DB 설계
**제공해주실 내용:**
1. 제공된 문서(PRD, 상세기능 명세서, IA & User Flow)를 분석한 요약
2. 추출한 데이터 요구사항 목록
3. 제안하는 DB 스키마 설계
   - 전체 테이블 목록 및 관계
   - 각 테이블의 상세 정의
   - ERD
   - 인덱스 전략
4. 불명확한 부분이나 확인이 필요한 질문

**검토 및 피드백 후 다음 단계 진행**

### Step 2: DB 스키마 확정 및 마이그레이션
1. 피드백 반영한 최종 스키마
2. 마이그레이션 파일 작성
3. ORM 모델 정의

### Step 3: 백엔드 구현
1. API 엔드포인트 개발
2. 비즈니스 로직 구현
3. 중간 리뷰

### Step 4: 프론트엔드 구현
1. 페이지 및 컴포넌트 구현
2. API 연동
3. 중간 리뷰

### Step 5: 통합 테스트 및 최종 점검
1. 전체 기능 테스트
2. 성능 테스트
3. 문서 최종 정리

## 8. 추가 고려사항
- **확장성**: 향후 기능 추가가 용이한 DB 구조 및 코드 구조
- **테스트**: 주요 기능에 대한 단위 테스트 포함
- **로깅**: 디버깅을 위한 적절한 로그
- **모니터링**: DB 쿼리 성능 모니터링 방안
- **백업**: 데이터 백업 및 복구 전략
- **반응형**: 모바일/태블릿/데스크톱 대응 (필요시)

## 9. DB 설계 참고 예시

### 좋은 스키마 설계 예시
```sql
-- 사용자 테이블
CREATE TABLE users (
  id BIGSERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  profile_image_url TEXT,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);

-- 이메일에 인덱스 (로그인 시 자주 조회)
CREATE INDEX idx_users_email ON users(email);

-- 게시글 테이블
CREATE TABLE posts (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  title VARCHAR(255) NOT NULL,
  content TEXT NOT NULL,
  view_count INTEGER DEFAULT 0,
  is_published BOOLEAN DEFAULT false,
  published_at TIMESTAMP,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);

-- 자주 사용되는 조회 조건에 복합 인덱스
CREATE INDEX idx_posts_user_published ON posts(user_id, is_published, published_at DESC);
```

### 피해야 할 안티패턴
- ❌ 모든 데이터를 하나의 거대한 테이블에 저장
- ❌ 관계를 무시하고 JSON에 모든 것 저장
- ❌ 인덱스 없이 설계
- ❌ 불명확한 컬럼명 (col1, data, info 등)
- ❌ 날짜를 문자열로 저장

---

## 10. 작업 방식

1. **첫 단계**: 문서 분석 후 이해한 내용을 요약하고, 불명확한 부분이나 잠재적 이슈를 질문해주세요.

2. **두 번째 단계**: 승인 후 핵심 기능부터 우선순위에 따라 순차적으로 구현해주세요.

3. **진행 중**: 각 주요 기능 완성 시 중간 리뷰를 위해 보고해주세요.

4. **최종 단계**: 전체 코드와 문서를 제공하고, 테스트 결과를 공유해주세요.

## 11. 추가 고려사항
- 확장성: 향후 기능 추가가 용이한 구조
- 테스트: 주요 기능에 대한 단위 테스트 포함
- 로깅: 디버깅을 위한 적절한 로그
- 반응형: 모바일/태블릿/데스크톱 대응 (필요시)

---

**첨부 문서:**
[[앱 이름(가칭): 커리맵] 기능 명세서

**1. 온보딩 및 홈 (Onboarding & Home)**
사용자의 데이터를 수집하고 맞춤형 첫인상을 주는 단계입니다.

| **구분** | **기능명** | **상세 설명** | **중요도** |
| --- | --- | --- | --- |
| **회원가입** | **자녀 프로필 설정** | • 자녀 닉네임, 나이(개월 수), 성별 등록
• **[핵심] 초기 레벨 진단:** 간단한 체크리스트 (예: 알파벳 인지, 파닉스 진행 중, 짧은 문장 읽기 가능 등) | **P0** |
| **취향 분석** | **취향 서베이** | • 아이가 좋아하는 관심사 태그 선택 (공룡, 자동차, 공주, 요리, 탐정, 우주 등)
• 선호하는 그림체 선택 (실사, 애니메이션, 수채화 등 이미지로 선택) | **P0** |
| **홈 화면** | **데일리 대시보드** | • 오늘의 추천 도서 1권 (Daily Pick)
• 현재 진행 중인 로드맵 진행률 바(Progress Bar)
• 읽은 책 누적 권수/단어 수 요약 | **P0** |

**2. 스마트 큐레이션 및 검색 (Search & Curation)**
페르소나 B(정체기맘)의 페인 포인트를 해결하는 핵심 기능입니다.

| **구분** | **기능명** | **상세 설명** | **중요도** |
| --- | --- | --- | --- |
| **검색** | **교차 필터 검색** | • **필터:** AR/Lexile 지수(난이도) × 주제(Keywords) × 분위기(Mood: 웃긴, 감동적인, 무서운)
• 예: AR 2.0 × 탐정 × 웃긴 책 | **P0** |
| **상세** | **도서 상세 페이지** | • 기본 서지 정보 + 미리보기 이미지
• **[핵심] 맘스 포인트:** 이 책의 매력 포인트 3줄 요약
• **[핵심] 엄마표 가이드:** 아이와 함께 나눌 대화 소재, 핵심 어휘, 독후 활동 팁 제공 | **P0** |
| **추천** | **유사 도서 추천** | • "이 책을 좋아한 아이들이 읽은 책" 알고리즘 추천
• 시리즈 연계 정보 (예: Fly Guy 1권을 봤으면 2권으로 유도) | **P1** |
| **연계** | **구해오기(Get it)** | • 온라인 서점 구매 링크 연동
• (추후) 내 주변 영어도서관 대여 가능 여부 연동 (LBS) | **P1** |

**3. 로드맵 및 가이드 (Roadmap & Guide)**
페르소나 A(입문맘)에게 길을 알려주는 내비게이션 기능입니다.

| **구분** | **기능명** | **상세 설명** | **중요도** |
| --- | --- | --- | --- |
| **로드맵** | **단계별 코스** | • 레벨별 코스 제공 (예: 옐로우 코스 - 흘려듣기 100시간)
• 코스 내 필수 도서 리스트 제공 | **P0** |
| **콘텐츠** | **가이드 콘텐츠** | • 엄마표 영어 방법론 아티클/영상 제공 (피드 형태)
• 시기별 Q&A (예: "아이가 영어책을 거부해요" 대처법) | **P1** |
| **알림** | **마일스톤 푸시** | • 특정 단계 도달 시 다음 단계 액션 플랜 알림 발송 | **P1** |

**4. 독서 기록 및 관리 (Tracker & Report)**
페르소나 C(초등맘)의 불안감을 해소하고 성취감을 주는 기능입니다.

| **구분** | **기능명** | **상세 설명** | **중요도** |
| --- | --- | --- | --- |
| **기록** | **간편 등록** | • 책 뒷면 ISBN 바코드 스캔으로 즉시 등록
• 읽은 날짜, 아이의 반응(좋아요/보통/싫어요 이모지) 기록 | **P0** |
| **통계** | **월간 리포트** | • 월별 독서량 그래프, 누적 어휘 수 추산
• 읽은 책의 장르 편식 분석 (예: "이번 달은 과학 책을 많이 읽었어요") | **P0** |
| **보상** | **엄마 뱃지** | • 연속 기록, 누적 권수 달성 시 '엄마'에게 칭찬 뱃지 부여 | **P1** |
| **서재** | **내 서재(책장)** | • 읽은 책(Read), 읽을 책(Wish), 읽고 있는 책(Reading) 분류 | **P0** |

**💡 시스템 아키텍처 관점의 핵심 고려사항**
기획 단계에서 개발팀에 미리 전달해야 할 **데이터 구조(Data Structure)**의 핵심 포인트입니다.
1. **도서 DB의 메타데이터 고도화:**
    ◦ 일반 서점 API에는 '분위기(Mood)'나 '엄마표 팁' 데이터가 없습니다.
    ◦ 따라서, **기본 서지 정보(ISBN, 제목, 저자)**는 외부 API(알라딘/아마존 등)에서 가져오더라도, 우리만의 **자체 태그(Tag) DB**를 구축하는 것이 이 사업의 핵심 자산이 됩니다.
    ◦ *전략: 초기 1,000권의 필독서는 직접 태깅 작업을 해야 합니다.*
2. **추천 알고리즘 로직:**
    ◦ 초기에는 복잡한 AI보다 **'규칙 기반(Rule-based)' 필터링**으로 시작하는 것이 좋습니다.
    ◦ 예: `User_Interest(공룡) AND User_Level(AR 1.5) match Book_Tag`

메뉴 구조도 (IA) 및 사용자 흐름 정의 (User Flow)

**1. 앱 메뉴 구조도 (Information Architecture - IA)**
앱의 최상위 네비게이션(Bottom Tab Bar)을 기준으로 화면의 깊이(Depth)를 정의합니다.

| **Depth 1 (Bottom Tab)** | **Depth 2 (메인 화면)** | **Depth 3 (상세 화면)** | **Depth 4 (모달/기타)** |
| --- | --- | --- | --- |
| **홈 (Home)** | HomeScreen | MissionDetailScreen (도서 상세) | MissionProgressScreen (체크리스트) |
|  |  | BookLogManualScreen (자유 기록 검색) |  |
| **로드맵 (Roadmap)** | RoadmapScreen (현재 코스 지도) | LevelDetailScreen (현재 레벨 전체 리스트) |  |
| **검색 (Search)** | SearchScreen (교차 필터) | MissionDetailScreen (도서 상세) |  |
| **마이페이지 (My)** | MyPageScreen | ChildProfileScreen (프로필 수정) | SettingsScreen (설정) |
|  |  | ReportScreen (성장 리포트) |  |

**2. 핵심 사용자 흐름 (Key User Flows)
Flow A: 최초 가입 및 온보딩 (First Run Setup)**
*이 흐름은 DB에 `user` 데이터가 없을 때만 실행됩니다.*

| **Step** | **화면/액션** | **로직/데이터 처리** | **이동 (Next Screen)** |
| --- | --- | --- | --- |
| **A1** | **시작 화면** | - | LoginScreen or SignUpScreen |
| **A2** | **회원가입** | 이메일, 비밀번호 등록 및 사용자 기본 정보 저장. | Onboarding/ChildInfoScreen |
| **A3** | **자녀 정보 입력** | 이름, 나이, 성별 입력. | Onboarding/InterestsScreen |
| **A4** | **취향 태그 선택** | **필수:** 이미지 그리드에서 3개 이상 `interests` 태그 선택. | Onboarding/DiagnosisScreen |
| **A5** | **레벨 자가 진단** | 난이도 선택(Pre-K, AR 0~1 등). | Onboarding/ResultScreen |
| **A6** | **초기 로드맵 설정 완료** | `current_level` 및 초기 `roadmap_queue` 세팅. | HomeScreen (완료) |

**Flow B: 일일 미션 수행 및 기록 (Daily Mission Flow)**
*가장 빈번하게 발생하는 핵심 흐름입니다.*

| **Step** | **화면/액션** | **로직/데이터 처리** | **이동 (Next Screen)** |
| --- | --- | --- | --- |
| **B1** | **홈 화면** | 오늘의 미션 도서 1권 노출 (추천 로직 적용). | MissionDetailScreen |
| **B2** | **도서 상세** | **액션:** [미션 시작하기] 버튼 클릭. | MissionProgressScreen |
| **B3** | **미션 진행 (체크리스트)** | 책 읽기, 맘스팁 따라 하기 등 체크리스트 수행. | MissionCompleteScreen (모든 체크 완료 시) |
| **B4** | **미션 완료 및 피드백** | **필수:** 아이 반응(Love/Soso/Hate) 선택. | (API Call) `mission_logs`에 기록, `read_count` +1, `word_count` 합산. |
| **B5** | **보상/결과** | 연속 학습일(Streak) 갱신 애니메이션. | HomeScreen |

**Flow C: 추천 도서가 아닌 다른 책 기록 (Manual Log Flow)**

| **Step** | **화면/액션** | **로직/데이터 처리** | **이동 (Next Screen)** |
| --- | --- | --- | --- |
| **C1** | **홈 화면** | **액션:** [오늘 다른 책을 읽었어요] 버튼 클릭. | BookLogManualScreen |
| **C2** | **자유 기록 검색** | 검색어로 `books` DB 검색. (ISBN 스캔 기능은 P1 고려) | MissionDetailScreen |
| **C3** | **도서 상세 확인** | 선택한 도서 정보 확인. **액션:** [이 책으로 미션 기록] 버튼 클릭. | MissionProgressScreen (B3로 합류) |

**Flow D: 로드맵 전체 조망 및 사전 준비 (Preparation Flow)**

**3. UI/UX 구현 주의사항 (Developer Guardrails)**
• **하단 탭 바 (Bottom Tab Bar):** 총 4개(홈, 로드맵, 검색, 마이페이지)의 탭은 항상 고정되어야 하며, 각 탭 내에서 화면 이동 시에는 하단 탭 바가 사라지지 않아야 합니다. (모달 제외)
• **뒤로가기 일관성:** 모든 Depth 3 이상의 화면에는 명확한 뒤로가기 버튼(혹은 제스처)이 있어야 합니다. (특히 모바일 앱의 필수 사항)
• **빈 화면 처리 (Empty State):** 미션 리스트나 검색 결과가 0건일 때, '데이터 없음' 메시지 대신 **"이런 조건으로 검색해 보세요"** 같은 유저 친화적인 메시지를 포함하여야 합니다.

| **Step** | **화면/액션** | **로직/데이터 처리** | **이동 (Next Screen)** |
| --- | --- | --- | --- |
| **D1** | **Bottom Tab:** 로드맵 | - | RoadmapScreen (Progress Map) |
| **D2** | **로드맵 화면** | **액션:** 현재 레벨 단계(예: AR 1.0 코스) 클릭. | LevelDetailScreen |
| **D3** | **레벨 상세 리스트** | 현재 레벨에 배정된 전체 도서 리스트 노출 (Sequence Order 순). | MissionDetailScreen |
| **D4** | **도서 상세** | **액션:** [구매 링크 이동] or [내 서재에 추가] | 외부 링크 이동 or `wishlist` DB 상태 변경 |

사업 정의

**1. 사업 정의 및 핵심 가치 (Brand Identity)**
• **슬로건(예시):** *"영어유치원보다 든든한, 내 아이 맞춤형 영어 큐레이터"*
• **핵심 가치:**
    ◦ **Customization:** 아이의 관심사와 레벨을 정밀하게 분석.
    ◦ **Roadmap:** 흔들리지 않는 장기적 가이드라인 제공.
    ◦ **Consistency:** 엄마가 지치지 않도록 돕는 시스템.
**2. 핵심 기능 3대 축 (The 3 Pillars)**
이 시스템은 크게 **진단/추천(Curation)**, **로드맵(Roadmap)**, **관리(Management)**로 구성됩니다.
**① 스마트 북 큐레이션 (Smart Curation)**
*"무엇을 읽혀야 할지 모르겠다"는 고민 해결*
• **취향 기반 매칭 (Taste Matcher):**
    ◦ 단순 레벨(AR/Lexile) 매칭이 아닌, **'소재(공룡, 공주, 자동차)'**와 **'장르(유머, 감동, 모험)'** 기반의 매칭 시스템.
    ◦ 예: "AR 2.0 수준이면서 자동차가 나오고 웃긴 책 찾아줘" $\rightarrow$ *'The Pigeon Drives the Bus'* 추천.
• **유사 도서 추천 (The "Netflix" for Books):**
    ◦ "아이가 *'ORT(Oxford Reading Tree)'*를 좋아했어요"라고 입력하면, 그와 비슷한 유머 코드와 문장 구조를 가진 다른 시리즈를 추천.
• **원서 미리보기 및 대여 연계:**
    ◦ 책 표지와 내지 스타일을 미리 확인하고, 구매 링크 혹은 근처 영어 도서관 대여 정보를 연계.
**② 단계별 커스텀 로드맵 (Custom Roadmap)**
*"지금 잘하고 있는지 불안하다"는 고민 해결*
• **시기별 가이드 (Infant to Elementary):**
    ◦ **0~3세 (노출기):** 흘려듣기 좋은 음원, 조작북, 마더구스 리스트.
    ◦ **4~6세 (발화/파닉스기):** 사이트 워드, 리더스북 진입 시점 알림.
    ◦ **7세~초등 (리딩 독립기):** 챕터북 진입, 정독과 다독의 밸런스 조절.
• **마일스톤 체크:**
    ◦ "지금 우리 아이는 '집중 듣기'가 필요한 시기입니다"와 같은 구체적 액션 플랜 푸시 알림.
**③ 독서 기록 및 성장 리포트 (Tracker & Report)**
*"엄마표 영어의 성과를 눈으로 확인하고 싶다"*
• **시각화된 독서 통계:** 읽은 책의 권수, 누적 단어 수 등을 그래프로 시각화하여 엄마에게 성취감 부여.
• **칭찬 뱃지 시스템:** 아이가 아닌 **'엄마'를 위한 보상** (예: "100일 연속 노출 달성 엄마!" 뱃지 부여)을 통해 동기 부여.
**3. 차별화 전략 (The "Killer" Feature)**
다른 도서 추천 서비스와 차별화되는 포인트는 **'실패 확률 줄이기'**입니다.**"실패한 전집(전집 실패)은 이제 그만!"**
• **샘플링 키트 (Sampling Kit):**
    ◦ 비싼 전집을 들이기 전, 해당 시리즈의 대표 원서 1~2권만 미리 읽어보고 아이 반응을 테스트할 수 있는 '맛보기 큐레이션' 기능.
• **엄마표 튜터링 (Mom's Guide):**
    ◦ 책만 던져주는 것이 아니라, *"이 책에서는 'Run away'라는 표현을 아이와 함께 외쳐보세요"* 같은 **구체적인 티칭 팁(가이드)**을 책마다 숏폼이나 텍스트로 제공.
**4. 수익 모델 (Business Model)**
1. **구독 모델 (Subscription):**
    ◦ 월/년 구독료를 받고 아이 맞춤형 로드맵 제공, 무제한 도서 추천, 독서 기록 데이터 관리.
2. **커머스/공구 (Commerce):**
    ◦ 추천된 원서(단행본, 세트) 바로 구매 기능.
    ◦ 인기 있는 원서 공구(공동구매) 진행 (수수료 수익).
3. **제휴 마케팅 (Affiliate):**
    ◦ 온라인 영어 도서관(e-book 플랫폼)이나 화상 영어 업체와 제휴하여 트래픽 연결 수수료.
**5. 초기 진입 전략 (Go-to-Market)**
• **타겟 커뮤니티 공략:** '잠수네' 키즈나 유명 맘카페에서 활동하는 엄마들에게 베타 테스터 권한 부여.
• **인스타그램 챌린지:** #엄마표영어100일챌린지 등을 주최하여, 앱을 통해 인증하게 함으로써 바이럴 유도.
• **데이터 확보:** 초기에는 "우리 아이 인생 책 3권을 알려주세요"라는 설문을 통해 아이들의 취향 데이터를 확보하고 DB를 구축.

상세 기능 명세서 & 로직 정의서

본 문서는 **User App(사용자 앱)**과 **Admin Web(관리자 웹)**의 세부 기능 및 데이터 처리 로직을 정의한다.
**A. User App (사용자 앱) 핵심 로직**

**0. 온보딩 & 진단 (Onboarding & Diagnosis) - 🔥 신규 추가**

- **목적:** 사용자 데이터를 수집하여 **초기 로드맵 코스(Level)**를 배정한다.
- **Flow:**
    1. **자녀 정보:** 이름, 나이(개월수), 성별.
    2. **관심사 태그:** 이미지 그리드에서 3개 이상 선택 (공룡, 공주, 탈것, 우주, 요리 등).
    3. **레벨 진단 (자가 진단):** * 질문: "아이가 영어책을 읽을 때..."
        - 선택지:
        A. 알파벳만 알아요 (Pre-K)
        B. 단어를 띄엄띄엄 읽어요 (AR 0~1)
        C. 짧은 문장을 혼자 읽어요 (AR 1~2)
        D. 챕터북을 읽을 수 있어요 (AR 2+)
    4. **결과 매칭:** 진단 결과에 따라 초기 `current_level` 설정 및 해당 레벨의 **추천 도서 리스트(Roadmap Queue)** 생성.

**1. 홈: 오늘의 미션 (Daily Mission) 추천 로직**
• **기능 정의:** 사용자 편의를 위해 '오늘 읽으면 딱 좋은 1권'을 제안하되, 선택권을 보장한다.
• **트리거:** 앱 실행 시 or 매일 자정(00:00) 갱신.
• **추천 알고리즘 (MVP 단계: Rule-based):**
    1. **필터링 1 (Level):** 자녀의 `current_level` ±0.5 범위 내의 도서 검색.
    2. **필터링 2 (Interest):** 자녀의 `interests` 배열과 도서의 `themes` 배열 중 1개 이상 일치하는 도서 검색.
    3. **필터링 3 (Unread):** `mission_logs` 테이블에 기록되지 않은(안 읽은) 도서만 추출.
    4. **선정 (Random):** 위 조건에 맞는 도서 중 랜덤 1권 선정.
    5. **예외 처리 (Fallback):**
        ▪ 조건에 맞는 책이 없을 경우 → `current_level`에 맞는 '베스트셀러(인기순)' 도서 노출.
        ▪ 그래도 없으면 → 관리자가 지정한 '필독 도서(Default)' 노출.

- **로직:**
    1. **Main Card:** 현재 진행 중인 로드맵 리스트 중 **가장 우선순위가 높은 1권** 노출.
    2. **새로고침(Swap):** "이 책은 집에 없어요/별로예요" 버튼 클릭 시.
        - Action: 같은 단계(Level) & 관심사(Interest) 내의 다른 도서로 즉시 교체.
        - 이때, '다음에 읽기(Skip)' 상태로 DB에 저장하여 리스트 순서 뒤로 보냄.
    3. **다른 책 기록하기(Log Anything):**
        - 상황: 추천된 책 말고 집에 있는 다른 원서를 읽었을 때.
        - Action: 검색창을 띄워 사용자가 직접 책을 찾고 미션 완료 처리. (이것도 오늘의 미션 성공으로 인정)

**2. 도서 검색: 교차 필터링 로직 (Smart Search)**
• **기능 정의:** 사용자가 지정한 복합 조건에 맞는 도서를 DB에서 쿼리하여 결과값을 리턴한다.
• **입력 변수 (Filters):**
    ◦ `AR Level` (예: 1.0 ~ 2.0)
    ◦ `Themes` (예: ['공룡', '자동차']) - 다중 선택 가능 (OR 조건)
    ◦ `Moods` (예: ['웃긴']) - **필수 구현 사항**
• **정렬 기준 (Sort):**
    ◦ 기본: 최신 등록순
    ◦ 옵션: 인기순 (`mission_logs`의 `child_reaction`이 'love'인 횟수 집계)

**3. 미션 완료 및 보상 로직 (Feedback Loop)**
• **기능 정의:** 미션 완료 버튼 클릭 시 데이터를 저장하고, 사용자에게 피드백을 제공한다.
• **데이터 처리 프로세스:**
    1. 사용자가 **[완료하기]** 버튼 클릭. (이미 완료한 책을 다시 클릭하여 **[또 읽었어요]** 버튼 클릭 가능.)
    2. 모달 팝업: **"아이가 책을 좋아했나요?"** (😍/🙂/☹️) 선택 필수.
    3. **DB 저장 (Transaction):**
        ▪ `mission_logs` 테이블에 `book_id`, `user_id`, `child_reaction` 저장.
        ▪ `books` 테이블의 해당 도서 `read_count` +1 증가 (인기도 산정용).
    4. **성장 데이터 갱신:**
        ▪ 해당 도서의 `word_count`를 가져와 사용자의 '누적 읽은 단어 수'에 합산.
        ▪ 연속 학습일(Streak) 계산 후 업데이트.

### 4. 로드맵 뷰 & 전체 리스트 (Roadmap View)

- **기능 정의:** 현재 위치를 파악하고 다음 읽을 책을 미리 준비(Pre-order)할 수 있는 지도 화면.
- **UI 구성:**
    - **Progress Map:** 구불구불한 길이나 스테이지 형태의 UI.
    - **현재 위치:** 내 아이의 캐릭터가 서 있는 위치 표시.
    - **도서 리스트 (Group):**
        - **완료한 책 (Past):** 흐릿하게 처리 + '3번 읽음' 뱃지 표시.
        - **현재 단계 (Current):** 컬러풀하게 활성화 + 클릭 시 구매/대여 정보 확인 가능.
        - **다음 단계 (Future):** 자물쇠 아이콘(잠금) 또는 반투명 처리 (목표 제시).
- **기능:**
    - **전체 보기:** 현재 레벨에 배정된 도서 리스트(예: 50권)를 한 번에 볼 수 있음 (쇼핑 리스트 역할).

### 5. 성장 리포트 (Report)

- **기능 정의:** 엄마표 영어의 불안감을 해소할 수 있는 데이터 시각화.
- **주요 지표:**
    - **누적 읽은 권수:** (반복 독서 포함)
    - **어휘 노출량 (Word Count):** 책 DB에 있는 단어 수 × 읽은 횟수 누적 합산.
        - *Visual:* "지금까지 아이가 마신 영어 단어는 사과 🍎 500개 분량이에요!"

**B. Admin Web (관리자 페이지) 기능 명세**
*개발사가 간과하기 쉬운 부분입니다. 반드시 스펙에 포함시켜야 합니다.*
**1. 대시보드 (Dashboard)**
• **기능:** 앱 운영 현황을 한눈에 파악.
• **주요 지표:**
    ◦ 총 회원 수 / 금일 가입자 수
    ◦ 누적 미션 완료 횟수
    ◦ **인기 검색 키워드 Top 10** (엄마들이 뭘 검색하는지 파악하여 도서 소싱에 활용)
**2. 도서 관리 (CMS) - 가장 중요**
• **기능:** 앱에 노출될 도서 데이터를 등록, 수정, 삭제하는 기능.
• **등록 프로세스 (Create):**
    1. **기본 정보 입력:** 제목, 저자, ISBN, 표지 이미지 URL, AR 레벨.
    2. **큐레이션 태그 선택 (체크박스):**
        ▪ 주제 (Themes): [ ]공룡 [ ]공주 [ ]일상 ...
        ▪ 분위기 (Moods): [ ]웃긴 [ ]감동 [ ]무서운 ...
    3. **엄마표 데이터 입력 (Text Area):**
        ▪ **Mom's Tip:** (예: "3페이지에서 늑대 흉내를 내주세요.")
        ▪ **Key Words:** (예: "Run, Pig, Wolf")
    4. **수익화 정보:** 구매 링크 URL 입력.
• **조회/수정:** 등록된 도서 리스트 조회 및 내용 수정.
**3. 사용자 관리 (User Management)**
• **기능:** 가입된 회원 리스트 조회.
• **상세:** 특정 회원의 자녀 프로필 정보(나이, 레벨) 및 미션 수행 이력 조회 (CS 대응용).
**C. 데이터베이스 연동 및 API 명세 (간략)**
개발자가 백엔드 API를 설계할 때 참고할 기준입니다.**MethodEndpoint설명필수 파라미터GET**`/api/books/daily`오늘의 미션 도서 1권 조회`user_id` (서버에서 레벨/취향 조회 후 로직 처리)**GET**`/api/books/search`필터 기반 도서 검색`min_ar`, `max_ar`, `themes[]`, `moods[]`**POST**`/api/mission/complete`미션 완료 및 피드백 저장`user_id`, `book_id`, `reaction`, `checklist`**GET**`/api/user/stats`사용자 성장 리포트 조회`user_id`
**D. 예외 처리 및 엣지 케이스 (Edge Cases)**
1. **네트워크 연결 끊김:**
    ◦ 미션 완료 버튼을 눌렀는데 인터넷이 끊긴 경우, 로컬 스토리지에 임시 저장했다가 네트워크 복구 시 자동 전송 (React Query/Offline Mutation 활용 권장).
2. **이미지 로딩 실패:**
    ◦ 도서 표지 이미지가 깨질 경우, 앱 로고가 들어간 'Default Placeholder' 이미지 노출.
3. **검색 결과 없음:**
    ◦ 필터 조건이 너무 까다로워 결과가 0건일 경우, **"조건을 하나만 줄여보세요!"**라는 문구와 함께 가장 근접한(유사한) 도서 리스트를 보여줌 (빈 화면 노출 금지).

## B. 데이터베이스 스키마 수정 요청 (DB Schema Updates)

개발자에게 아래 컬럼 추가/수정을 요청해야 합니다.

1. `books` 테이블:
    - `sequence_order`: 로드맵 내에서의 정렬 순서 (Int)
    - **삭제:** `mission_logs`에서 안 읽은 것만 가져오는 로직 삭제 (모두 가져오되 UI로 구분).
2. `mission_logs` 테이블:
    - `read_count`: 읽은 횟수 (Int, Default 1) - **반복 독서 카운팅용**.
    - `is_manual_log`: 추천이 아닌 직접 검색해서 등록했는지 여부 (Boolean).

[프로젝트명: CurriMap] 제품 요구사항 정의서 (PRD)

**1. 프로젝트 개요 (Overview)**
• **프로젝트명:** Milestone (가칭: 맘스리딩)
• **서비스 정의:** 엄마표 영어 학습을 돕는 **개인화 맞춤 로드맵 & 원서 큐레이션 플랫폼**
• **개발 목표:**
    ◦ 영유아~초등 자녀를 둔 부모에게 아이 수준/취향에 맞는 원서를 추천하고, 독서 기록을 체계적으로 관리하는 **MVP(Minimum Viable Product) 앱 개발**.
    ◦ **관리자(Admin) 페이지**를 통해 운영자가 도서 DB를 지속적으로 업데이트할 수 있어야 함.
• **타겟 유저:**
    ◦ **Primary:** 영유를 보내지 않고 집에서 영어를 교육하는 3040 엄마.
    ◦ **Pain Point:** "뭘 읽혀야 할지 모르겠다(큐레이션 부재)", "내가 잘하고 있는지 불안하다(로드맵 부재)".
**2. 개발 환경 및 기술 스택 (Tech Stack)**
*외주사가 준수해야 할 기술적 제약사항입니다.*
• **Client (App):** React Native (Expo 환경 권장)
• **Admin (Web):** React 기반의 웹 어드민 (템플릿 사용 무관)
• **Backend & DB:** Supabase (PostgreSQL)
    ◦ *이유:* 빠른 구축과 유지보수 용이성, 추후 확장성 고려.
• **OS:** Android, iOS 동시 출시 목표.
**3. 핵심 기능 요약 (Key Features)구분기능명상세 내용 (핵심 가치 반영)우선순위회원자녀 프로필 & 진단**자녀 나이, 성별, **관심사 태그(공룡, 차 등)**, 현재 레벨 입력. 
 *데이터 기반 추천의 기초가 됨.***P0큐레이션스마트 도서 검색교차 필터링:** AR지수 × 주제 × **분위기(웃긴, 감동)**. 
 단순 검색이 아닌 '조건 검색'이 핵심.**P0콘텐츠도서 상세 & 맘스팁**도서 정보 외 **'엄마표 팁(Mom's Tip)'** 및 **'핵심 발화 단어'** 노출. 
 구매 링크(수익화) 및 도서관 대여 체크박스 포함.**P0활동미션 & 리액션 기록**오늘의 추천 도서(미션) 수행 기능. 
 완료 시 **아이의 반응(좋음/보통/싫음)**을 필수 입력받아 DB 저장.**P0분석성장 리포트**월간 독서 권수, **누적 노출 단어 수(Word Count)** 시각화 그래프.**P1관리자CMS (콘텐츠 관리)**도서 데이터(표지, 태그, 맘스팁 등) 등록/수정/삭제 기능.**P0
4. 사용자 정책 (User Policy) - 중요!**
• **비회원 정책:** 앱 둘러보기는 가능하나, '미션 수행' 및 '기록 저장' 시 회원가입 강제 (전환 유도).
• **데이터 정책:**
    ◦ 도서 데이터는 외부 API(알라딘 등)에서 기본 정보를 가져오되, **'분위기 태그', '맘스팁'은 관리자 페이지에서 직접 입력**하여 우리만의 고유 DB를 구축한다.
• **알림 정책:** 매일 오전 9시(설정 가능) '오늘의 미션' 푸시 알림 발송.
**5. 비기능 요구사항 (Non-Functional Requirements)**
• **UI/UX:** 타겟(엄마)의 감성에 맞는 직관적이고 따뜻한 디자인. 복잡한 뎁스 지양.
• **속도:** 이미지(도서 표지) 로딩 최적화 필수 (캐싱 적용).
• **데이터 무결성:** 미션 기록 중 앱이 꺼져도 데이터가 유실되지 않아야 함.

타겟 페르소나 정의 (Personas)

**페르소나 A: "열정은 넘치지만 정보 과부하에 걸린 입문맘"**이름: 김민지 (32세, 전업주부)
자녀: 3세 남아 (에너지 넘침, 자동차 마니아)
현재 상황: 인스타그램에서 또래 아이들이 영어 하는 걸 보고 마음이 급함. 비싼 전집을 샀는데 아이가 거들떠도 안 봐서 좌절 중.
• **Pain Point:** "남들이 좋다는 건 다 샀는데 우리 애는 왜 안 볼까? 뭐부터 다시 시작해야 하지?"
• **Need:** 실패 없는 책 추천, 아주 기초적인 로드맵, '내가 잘하고 있다'는 확신.
**페르소나 B: "영어 권태기에 빠진 아이 때문에 지친 정체기맘"**이름: 박혜진 (39세, 워킹맘)
자녀: 7세 여아 (취향 확고, 공주/요정 좋아함)
현재 상황: 어릴 때 노출을 꽤 해줬는데, 한글책 재미를 알게 되면서 영어를 거부하기 시작함(영어 거부기). 레벨을 올려야 하는데 아이와 싸우기 싫음.
• **Pain Point:** "유명한 리더스북(ORT 등)은 지겹대요. 아이 수준(AR)에 맞으면서도 '공주'가 나오는 재미있는 책 없나요?"
• **Need:** 정교한 취향 매칭 검색, 아이의 흥미를 다시 끌어올릴 '숨겨진 보석' 같은 원서.
**페르소나 C: "체계적인 관리가 필요한 초등 대비맘"**이름: 최수영 (41세, 프리랜서)
자녀: 초등 2학년 남아 (학습식 영어 싫어함)
현재 상황: 학원을 보내려다 아이가 스트레스받아 해서 다시 엄마표로 선회. 하지만 이제는 마냥 놀 수만은 없고 '리딩 실력'을 쌓아야 함.
• **Pain Point:** "그냥 읽히기만 해서는 안 될 것 같아요. 챕터북으로 넘어가야 하는데 로드맵이 필요하고, 얼마나 읽었는지 기록 관리가 필요해요."
• **Need:** AR/Lexile 지수 기반의 체계적 로드맵, 독서 이력 관리(Tracker), 챕터북 진입 가이드.
**2. 사용자 시나리오 (User Scenarios)**
이 페르소나들이 우리 서비스를 통해 어떻게 문제를 해결하는지 구체적인 장면(Scene)으로 묘사합니다.
**시나리오 1: 입문맘 민지 씨의 "전집 실패 탈출기"**
1. **진입:** 민지 씨는 아이가 비싼 전집을 던지는 것을 보고 속상해하며 앱을 켠다.
2. **진단:** 앱이 묻는다. *"아이가 가장 좋아하는 장난감이 뭔가요?"* $\rightarrow$ [자동차/탈것] 선택. *"아이가 좋아하는 한글책 스타일은?"* $\rightarrow$ [쨍한 그림/조작북] 선택.
3. **추천:** 시스템이 '국민 전집' 대신, 자동차가 주인공인 단행본 원서 3권과 관련 유튜브 노래(Super Simple Songs) 링크를 추천한다.
    ◦ *추천 멘트: "민지님, 전집보다는 아이가 좋아하는 '자동차'로 먼저 영어가 놀이임을 알려주세요."*
4. **가이드:** 책과 함께 **[엄마를 위한 1분 팁]**이 뜬다. *"이 페이지에서는 'Vroom Vroom' 소리를 과장되게 내주세요."*
5. **결과:** 아이가 깔깔거리며 책을 가져온다. 민지 씨는 '로드맵 시작하기' 버튼을 누른다.
**시나리오 2: 정체기맘 혜진 씨의 "취향 저격 발굴기"**
1. **문제 발생:** 퇴근 후 아이에게 영어책을 읽어주려 하자 아이가 "이거 재미없어, 안 읽을래"라며 도망간다.
2. **검색:** 혜진 씨는 앱의 **[스마트 검색]**에 들어간다.
    ◦ 레벨 설정: AR 1.5 ~ 2.0 (초기 리더스 단계)
    ◦ 키워드 선택: #공주 #마법 #웃긴(Funny) #그림이예쁜
3. **발견:** 뻔한 디즈니 책이 아닌, *'The Princess in Black'* (공주가 히어로로 변신하는 내용) 시리즈가 추천된다. *"이 책은 공주를 좋아하지만 얌전한 건 싫어하는 아이들에게 딱이에요!"*라는 후기가 보인다.
4. **확인:** '속지 미리보기'로 그림체를 확인하고 도서관 대여 가능 여부를 확인한다.
5. **결과:** 아이가 표지를 보자마자 흥미를 보인다. 영어 거부기를 극복하고 다시 리딩을 이어간다.
**시나리오 3: 초등맘 수영 씨의 "챕터북 정복 로드맵"**
1. **접속:** 수영 씨는 아이가 이번 달에 읽은 책의 누적 단어 수가 궁금해 앱에 접속한다.
2. **리포트 확인:** **[이번 달 독서 리포트]**에서 누적 단어 수와 읽은 책 권수가 그래프로 뜬다. *"축하해요! 해리포터 1권을 읽을 수 있는 기초 체력이 80% 완성되었어요."*
3. **로드맵 알림:** 시스템이 다음 단계를 제안한다. *"지금 읽고 있는 'Nate the Great' 다음으로는 문장이 조금 더 길어지는 'Magic Tree House' 1~4권을 추천합니다. 오디오북과 함께 집중 듣기를 시도해 보세요."*
4. **실행:** 추천된 로드맵을 '내 보관함'에 담고, 체크리스트 기능을 켠다.
5. **결과:** 학원 레벨테스트 없이도 집에서 체계적으로 아이의 레벨 업 과정을 눈으로 확인하며 안심한다.
**3. 핵심 기능 도출 (Feature Mapping)**
위 시나리오를 바탕으로 **'필수 기능'**이 명확해졌습니다.

페르소나	- 필요 기능 (Feature)	- 서비스 가치 (Value)
입문맘	- 취향 기반 큐레이션, 엄마표 티칭 가이드(1분 팁)	- "영어는 공부가 아니라 놀이라는 인식 심어주기"
정체기맘	- 키워드 교차 검색 (레벨 x 소재 x 분위기)	- "아이의 취향을 맞춰 흥미 소생시키기"
초등맘	- 독서 대시보드(통계), 시리즈 연계 로드맵	- "학원 없이도 체계적인 레벨 업 관리"
    ]

**시작 전 질문:**
문서를 검토한 후, 프로젝트를 명확히 이해했는지 요약해주시고, 궁금하거나 명확히 해야 할 사항이 있다면 질문해주세요.